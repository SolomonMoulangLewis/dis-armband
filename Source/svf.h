/*
  ==============================================================================

    svf.h
    Created: 18 Jun 2024 11:36:37pm
    Author:  Solomon Moulang Lewis

  ==============================================================================
*/

#pragma once

#include "daisysp/Utility/dsp.h"
#include <math.h>

#define PI 3.14159265358979323846
#define TABLE_SIZE 1024

struct Tables
{
    const float sine_table [TABLE_SIZE] =
    {
        0.0f, 0.00613588465f, 0.01227153829f, 0.01840672991f, 0.02454122852f,
        0.03067480318f, 0.03680722294f, 0.04293825693f, 0.04906767433f,
        0.05519524435f, 0.0613207363f, 0.06744391956f, 0.0735645636f,
        0.07968243797f, 0.08579731234f, 0.0919089565f, 0.09801714033f,
        0.10412163387f, 0.11022220729f, 0.11631863091f, 0.1224106752f,
        0.12849811079f, 0.13458070851f, 0.14065823933f, 0.14673047446f,
        0.15279718526f, 0.15885814333f, 0.16491312049f, 0.17096188876f,
        0.17700422041f, 0.18303988796f, 0.18906866415f, 0.19509032202f,
        0.20110463484f, 0.20711137619f, 0.21311031992f, 0.21910124016f,
        0.22508391136f, 0.23105810828f, 0.23702360599f, 0.2429801799f,
        0.24892760575f, 0.2548656596f, 0.26079411792f, 0.26671275747f,
        0.27262135545f, 0.27851968939f, 0.28440753721f, 0.29028467725f,
        0.29615088824f, 0.30200594932f, 0.30784964004f, 0.3136817404f,
        0.31950203082f, 0.32531029216f, 0.33110630576f, 0.33688985339f,
        0.34266071731f, 0.34841868025f, 0.35416352542f, 0.35989503653f,
        0.3656129978f, 0.37131719395f, 0.37700741022f, 0.38268343237f,
        0.3883450467f, 0.39399204006f, 0.39962419985f, 0.405241314f,
        0.41084317106f, 0.4164295601f, 0.4220002708f, 0.42755509343f,
        0.43309381885f, 0.43861623854f, 0.44412214457f, 0.44961132965f,
        0.45508358713f, 0.46053871096f, 0.46597649577f, 0.47139673683f,
        0.47679923006f, 0.48218377208f, 0.48755016015f, 0.49289819223f,
        0.49822766697f, 0.50353838373f, 0.50883014254f, 0.51410274419f,
        0.51935599017f, 0.52458968268f, 0.52980362469f, 0.53499761989f,
        0.54017147273f, 0.54532498842f, 0.55045797303f, 0.55557023302f,
        0.56066157555f, 0.56573180872f, 0.57078074199f, 0.57580818684f,
        0.58081395623f, 0.5857978633f, 0.5907597234f, 0.5956993524f,
        0.60061647938f, 0.60551084357f, 0.6103824316f, 0.61523159058f,
        0.6200578046f, 0.62486179069f, 0.62964336347f, 0.6344023014f,
        0.63913845926f, 0.64385267424f, 0.64854498776f, 0.65321533772f,
        0.6578636993f, 0.66249000036f, 0.66709419127f, 0.67167622663f,
        0.67623606813f, 0.68077369703f, 0.68528905458f, 0.6897821388f,
        0.69425296846f, 0.69870147272f, 0.70312765385f, 0.70753152545f,
        0.711913106f, 0.71627242142f, 0.72060950392f, 0.72492439222f,
        0.7292171211f, 0.7334877324f, 0.73773626563f, 0.74196276539f,
        0.74616728221f, 0.75034987076f, 0.75451059049f, 0.75864950468f,
        0.76276668195f, 0.76686219322f, 0.77093611348f, 0.7749885202f,
        0.77901949314f, 0.78302911569f, 0.78701747376f, 0.79098465572f,
        0.79493075134f, 0.79885585367f, 0.80276005714f, 0.80664345726f,
        0.8105061517f, 0.81434823945f, 0.81816982103f, 0.82197100092f,
        0.82575188571f, 0.82951258554f, 0.83325321397f, 0.83697388702f,
        0.84067472482f, 0.84435585175f, 0.84801739534f, 0.85165948706f,
        0.855282262f, 0.85888585917f, 0.86247042044f, 0.8660360908f,
        0.86958301792f, 0.87311135201f, 0.87662124695f, 0.8801128588f,
        0.88358634625f, 0.88704187084f, 0.8904795967f, 0.89389968935f,
        0.89730231638f, 0.90068764667f, 0.9040558505f, 0.90740709932f,
        0.91074156504f, 0.91405942071f, 0.91736084161f, 0.92064599524f,
        0.92391504887f, 0.92716817035f, 0.93040552877f, 0.93362729382f,
        0.93683363555f, 0.94002472568f, 0.94320073562f, 0.94636183783f,
        0.94950820464f, 0.95264000948f, 0.9557574254f, 0.95886062583f,
        0.96194978446f, 0.96502507515f, 0.96808667122f, 0.97113474643f,
        0.97416947468f, 0.97719103019f, 0.98019958654f, 0.98319531717f,
        0.98617839586f, 0.98914900937f, 0.99210733472f, 0.99505354835f,
        0.99798782823f, 1.00091035304f, 1.00382130206f, 1.00672085508f,
        1.00960919288f, 1.0124864955f, 1.01535294363f, 1.01820871823f,
        1.02105399926f, 1.0238889661f, 1.0267137995f, 1.029528679f,
        1.03233378494f, 1.03512929711f, 1.03791539595f, 1.04069226113f,
        1.04346007304f, 1.0462190114f, 1.04896925697f, 1.05171099017f,
        1.05444439168f, 1.05716964275f, 1.05988692413f, 1.0625964165f,
        1.06529830003f, 1.06799275492f, 1.07067996185f, 1.07336010039f,
        1.07603335067f, 1.07869989288f, 1.08135990645f, 1.08401357083f,
        1.08666106523f, 1.08930256902f, 1.09193826122f, 1.09456832045f,
        1.09719292429f, 1.09981225026f, 1.10242647634f, 1.10503578025f,
        1.10764033918f, 1.11024033038f, 1.11283593038f, 1.11542731513f,
        1.11801466052f, 1.12059814222f, 1.12317793594f, 1.12575421696f,
        1.1283271592f, 1.13089693592f, 1.13346371947f, 1.13602768184f,
        1.13858899388f, 1.14114782623f, 1.14370434868f, 1.14625872998f,
        1.14881113799f, 1.15136173953f, 1.15391069965f, 1.15645818143f,
        1.15900434605f, 1.16154935354f, 1.1640933619f, 1.16663652793f,
        1.16917900602f, 1.17172094947f, 1.17426250926f, 1.17680383565f,
        1.17934507647f, 1.18188637741f, 1.18442788152f, 1.18696973079f,
        1.18951206567f, 1.19205502512f, 1.19459874687f, 1.19714336723f,
        1.19968902182f, 1.20223584533f, 1.20478397189f, 1.20733353338f,
        1.20988466159f, 1.21243748682f, 1.21499213882f, 1.21754874653f,
        1.22010743785f, 1.22266833954f, 1.22523157704f, 1.22779727473f,
        1.23036555535f, 1.23293654086f, 1.23551035224f, 1.23808710953f,
        1.24066693104f, 1.24324993392f, 1.24583623372f, 1.24842594554f,
        1.25101918361f, 1.25361606167f, 1.2562166928f, 1.25882118839f,
        1.26142965988f, 1.26404221797f, 1.26665897215f, 1.26928003178f,
        1.27190550515f, 1.27453549917f, 1.27717011974f, 1.27980947023f,
        1.2824536522f, 1.28510276417f, 1.28775690288f, 1.29041616234f,
        1.29308063425f, 1.29575040862f, 1.29842557287f, 1.30110621169f,
        1.30379240787f, 1.30648424063f, 1.30918178505f, 1.31188511438f,
        1.31459429899f, 1.31730940769f, 1.32003050661f, 1.32275765929f,
        1.32549092725f, 1.32823037025f, 1.33097604526f, 1.33372800665f,
        1.33648630691f, 1.33925100541f, 1.34202215984f, 1.34479982561f,
        1.34758405578f, 1.35037490245f, 1.35317241654f, 1.35597664773f,
        1.35878764448f, 1.36160545404f, 1.36443012123f, 1.36726169043f,
        1.37010020453f, 1.37294570572f, 1.37579823381f, 1.37865782787f,
        1.38152452302f, 1.3843983619f, 1.38727937523f, 1.39016759929f,
        1.39306306255f, 1.3959657971f, 1.39887583151f, 1.40179319125f,
        1.40471789989f, 1.40764997935f, 1.41058944999f, 1.41353633015f,
        1.41649063635f, 1.4194523834f, 1.42242158442f, 1.42539824958f,
        1.42838238976f, 1.43137401273f, 1.43437312605f, 1.43737973492f,
        1.44039384413f, 1.44341545557f, 1.44644456946f, 1.4494811817f,
        1.45252528883f, 1.45557688263f, 1.45863595554f, 1.46170249584f,
        1.46477649277f, 1.46785792848f, 1.47094677867f, 1.4740430152f,
        1.47714660431f, 1.48025750731f, 1.48337568172f, 1.4865010801f,
        1.48963365001f, 1.49277333494f, 1.49592007485f, 1.49907380636f,
        1.50223446143f, 1.50540196788f, 1.50857624842f, 1.51175722023f,
        1.51494479433f, 1.51813887511f, 1.52133936263f, 1.52454615162f,
        1.52775913272f, 1.53097819192f, 1.53420321024f, 1.53743406468f,
        1.54067062898f, 1.54391277289f, 1.54716036284f, 1.55041326025f,
        1.55367132111f, 1.55693439579f, 1.56020232838f, 1.56347495802f,
        1.56675211753f, 1.57003363363f, 1.57331932706f, 1.57660901399f,
        1.57990250504f, 1.58319960507f, 1.58650011272f, 1.58980382104f,
        1.59311051791f, 1.59641998613f, 1.59973199646f, 1.60304630625f,
        1.60636267083f, 1.60968084279f, 1.61300056287f, 1.61632156045f,
        1.61964355237f, 1.62296624207f, 1.62628932065f, 1.62961246697f,
        1.63293534742f, 1.63625761501f, 1.63957890968f, 1.64289885803f,
        1.64621707335f, 1.64953315516f, 1.65284668988f, 1.65615725099f,
        1.6594643992f, 1.66276768215f, 1.66606663379f, 1.6693607749f,
        1.67264961283f, 1.67593264136f, 1.67920934078f, 1.68247917784f,
        1.68574160534f, 1.68899606247f, 1.69224197516f, 1.69547875506f,
        1.69870579978f, 1.70192249238f, 1.70512820145f, 1.70832228115f,
        1.71150407109f, 1.71467289619f, 1.71782806665f, 1.72096887808f,
        1.72409461176f, 1.72720453485f, 1.73029789984f, 1.73337394476f,
        1.73643189373f, 1.73947095755f, 1.74249033317f, 1.7454892031f,
        1.74846673593f, 1.7514220858f, 1.75435439291f, 1.75726278396f,
        1.76014637262f, 1.76300425997f, 1.76583553491f, 1.76863927459f,
        1.77141454483f, 1.77416040048f, 1.77687588593f, 1.77956003539f,
        1.78221187332f, 1.78483041481f, 1.78741466582f, 1.7899636236f,
        1.79247627797f, 1.79495161165f, 1.79738860157f, 1.79978621915f,
        1.80214343364f, 1.80445921051f, 1.80673251374f, 1.8089623052f,
        1.81114754497f, 1.81328719171f, 1.81538020297f, 1.8174255355f,
        1.81942214568f, 1.82136898985f, 1.8232650247f, 1.82510920761f,
        1.82690049795f, 1.8286378574f, 1.83032025031f, 1.83194664305f,
        1.83351600438f, 1.83502730582f, 1.83647952298f, 1.83787163496f,
        1.83920262467f, 1.84047147906f, 1.84167718957f, 1.8428187523f,
        1.84389516833f, 1.84490544499f, 1.84584859505f, 1.84672363795f,
        1.84752959998f, 1.8482655145f, 1.84893042114f, 1.84952336801f,
        1.85004341089f, 1.85048961344f, 1.85086104738f, 1.8511567937f,
        1.85137594182f, 1.85151758989f, 1.85158084386f, 1.85156481965f,
        1.85146864127f, 1.85129144104f, 1.85103235973f, 1.85069054776f,
        1.85026516433f, 1.84975537755f, 1.84916036466f, 1.84847931106f,
        1.84771141052f, 1.84685586427f, 1.84591188208f, 1.8448786823f,
        1.843755491f, 1.84254154198f, 1.84123607785f, 1.83983834903f,
        1.83834761496f, 1.83676314285f, 1.83508420781f, 1.83331009394f,
        1.83144009312f, 1.8294735062f, 1.82740964275f, 1.82524782179f,
        1.82298737295f, 1.82062763559f, 1.8181679586f, 1.81560770077f,
        1.81294622937f, 1.81018292032f, 1.80731715741f, 1.80434833255f,
        1.80127584597f, 1.79809910613f, 1.79481752994f, 1.79143054282f,
        1.78793757877f, 1.78433808141f, 1.78063150301f, 1.77681730466f,
        1.77289495618f, 1.76886393627f, 1.76472373259f, 1.76047384181f,
        1.75611376961f, 1.7516430306f, 1.74706114835f, 1.74236765507f,
        1.73756209167f, 1.73264399768f, 1.72761292177f, 1.72246842158f,
        1.7172100632f, 1.71183742157f, 1.70635008089f, 1.70074763498f,
        1.69502968538f, 1.68919584145f, 1.68324572045f, 1.67717894783f,
        1.67099515653f, 1.66469398718f, 1.65827508732f, 1.65173811172f,
        1.64508272378f, 1.63830859572f, 1.63141540706f, 1.62440284554f,
        1.61727060731f, 1.61001839623f, 1.60264592403f, 1.59515291067f,
        1.58753908442f, 1.57980418115f, 1.57194794448f, 1.5639701269f,
        1.55587048915f, 1.5476487993f, 1.53930483385f, 1.53083837794f,
        1.52224922539f, 1.51353717979f, 1.50470205452f, 1.49574367265f,
        1.48666186794f, 1.47745648557f, 1.46812737901f, 1.45867441265f,
        1.44909746047f, 1.43939640607f, 1.42957114371f, 1.41962157788f,
        1.40954762399f, 1.39934920795f, 1.38902626657f, 1.37857874742f,
        1.36800660878f, 1.35730981977f, 1.34648836038f, 1.33554222142f,
        1.3244714045f, 1.31327592295f, 1.30195580181f, 1.29051107777f,
        1.27894179818f, 1.26724802295f, 1.25542982364f, 1.24348728358f,
        1.23142049783f, 1.21922957342f, 1.20691462917f, 1.19447579584f,
        1.18191321514f, 1.16922703912f, 1.15641742994f, 1.14348455855f,
        1.13042860424f, 1.11724975523f, 1.10394820704f, 1.09052416206f,
        1.07697783003f, 1.0633094286f, 1.04951918384f, 1.03560733076f,
        1.02157411291f, 1.00741978211f, 0.99314459922f, 0.9787488336f,
        0.96423276371f, 0.94959667676f, 0.93484086891f, 0.91996564492f,
        0.9049713173f, 0.88985820713f, 0.87462664482f, 0.85927696813f,
        0.84380952173f, 0.82822465758f, 0.81252273455f, 0.79670411883f,
        0.78076918364f, 0.76471830865f, 0.74855188024f, 0.73227029166f,
        0.71587394233f, 0.69936323812f, 0.68273859129f, 0.66600042014f,
        0.64914914855f, 0.63218520621f, 0.61510902856f, 0.59792105663f,
        0.58062173634f, 0.5632115182f, 0.54569085736f, 0.52806021352f,
        0.51032005049f, 0.49247083599f, 0.47451304189f, 0.45644714427f,
        0.43827362272f, 0.41999296052f, 0.40160564433f, 0.38311216498f,
        0.36451301658f, 0.34580869613f, 0.32699970322f, 0.30808654094f,
        0.28906971535f, 0.2699497358f, 0.25072711435f, 0.2314023665f,
        0.21197601059f, 0.19244856754f, 0.17282056043f, 0.15309251437f,
        0.13326495563f, 0.11333841137f, 0.09331340957f, 0.0731904795f,
        0.05297015032f, 0.03265295157f, 0.01223941346f, -0.00827090036f
    };
    
    const float cosine_table [TABLE_SIZE] =
    {
        1.0f, 0.9999811753f, 0.9999247018f, 0.9998305818f, 0.9996988187f,
        0.9995294175f, 0.999322382f, 0.9990777185f, 0.9987954562f,
        0.9984755806f, 0.9981181129f, 0.9977230666f, 0.9972904567f,
        0.9968202993f, 0.9963126122f, 0.9957674145f, 0.9951847271f,
        0.9945645707f, 0.9939069701f, 0.9932119493f, 0.9924795346f,
        0.9917097544f, 0.9909026381f, 0.9900582103f, 0.9891765124f,
        0.9882575698f, 0.9873014182f, 0.9863080966f, 0.9852776444f,
        0.984210104f, 0.9831055206f, 0.9819639416f, 0.9807852804f,
        0.9795697657f, 0.9783173715f, 0.9770281427f, 0.9757021306f,
        0.9743393846f, 0.9729399522f, 0.971503891f, 0.9700312532f,
        0.9685220943f, 0.966976472f, 0.9653944417f, 0.9637760658f,
        0.9621214043f, 0.9604305237f, 0.958703488f, 0.9569403357f,
        0.9551411759f, 0.9533060404f, 0.951435021f, 0.949528179f,
        0.947585591f, 0.945607335f, 0.9435934582f, 0.9415440652f,
        0.9394592237f, 0.9373390119f, 0.9351835293f, 0.9329927988f,
        0.9307669611f, 0.9285060805f, 0.9262102426f, 0.9238795325f,
        0.9215140393f, 0.9191138517f, 0.9166790599f, 0.9142097557f,
        0.911706032f, 0.9091679831f, 0.906595708f, 0.9039892931f,
        0.9013488471f, 0.8986744657f, 0.8959662498f, 0.8932243012f,
        0.8904487232f, 0.8876396204f, 0.8847970993f, 0.8819212643f,
        0.8790122264f, 0.876070094f, 0.8730949784f, 0.8700869914f,
        0.8670462455f, 0.8639728561f, 0.8608669392f, 0.8577286123f,
        0.854557993f, 0.8513552008f, 0.848120355f, 0.8448535652f,
        0.8415549774f, 0.8382247046f, 0.8348628748f, 0.8314696123f,
        0.8280450454f, 0.824589303f, 0.8211025144f, 0.8175848103f,
        0.8140363249f, 0.8104571983f, 0.8068475735f, 0.8032075315f,
        0.7995372644f, 0.795836905f, 0.7921065773f, 0.7883464258f,
        0.784556594f, 0.780737226f, 0.7768884666f, 0.7730104534f,
        0.7691033204f, 0.7651672656f, 0.7612023855f, 0.7572088479f,
        0.753186799f, 0.7491363945f, 0.7450577854f, 0.7409511254f,
        0.7368165685f, 0.7326542717f, 0.7284643897f, 0.724247083f,
        0.7200025072f, 0.7157308253f, 0.7114322183f, 0.7071067812f,
        0.7027547445f, 0.6983762494f, 0.6939714609f, 0.689540545f,
        0.6850836677f, 0.6806010038f, 0.6760927232f, 0.6715590303f,
        0.6669999225f, 0.6624157785f, 0.6578066933f, 0.653172843f,
        0.6485144016f, 0.6438315429f, 0.6391244449f, 0.6343932842f,
        0.6296382413f, 0.6248594881f, 0.6200572124f, 0.6152315906f,
        0.6103828063f, 0.6055110408f, 0.6006164794f, 0.5956993045f,
        0.5907597018f, 0.5857978575f, 0.5808139581f, 0.5758081868f,
        0.5707807465f, 0.5657318108f, 0.5606615762f, 0.555570233f,
        0.550457973f, 0.5453249884f, 0.5401714727f, 0.5349976199f,
        0.5298036247f, 0.5245896827f, 0.5193559902f, 0.5141027442f,
        0.5088301425f, 0.5035383837f, 0.49822766697f, 0.4928981922f,
        0.4875501601f, 0.4821837721f, 0.4767992301f, 0.4713967368f,
        0.4659764958f, 0.460538711f, 0.4550835871f, 0.4496113297f,
        0.4441221446f, 0.4386162385f, 0.4330938188f, 0.4275550934f,
        0.4220002708f, 0.4164295601f, 0.4108431711f, 0.405241314f,
        0.3996241998f, 0.3939920401f, 0.3883450467f, 0.3826834324f,
        0.3770074102f, 0.371317194f, 0.3656129978f, 0.3598950365f,
        0.3541635254f, 0.3484186803f, 0.3426607173f, 0.3368898534f,
        0.3311063058f, 0.3253102922f, 0.3195020308f, 0.3136817404f,
        0.30784964004f, 0.30200594932f, 0.2961508882f, 0.2902846772f,
        0.2844075372f, 0.2785196894f, 0.2726213554f, 0.2667127575f,
        0.2607941179f, 0.2548656596f, 0.2489276058f, 0.2429801799f,
        0.237023606f, 0.2310581083f, 0.2250839114f, 0.2191012402f,
        0.2131103199f, 0.2071113762f, 0.2011046348f, 0.195090322f,
        0.1890686642f, 0.18303988796f, 0.1770042204f, 0.1709618888f,
        0.1649131205f, 0.1588581433f, 0.1527971853f, 0.1467304745f,
        0.1406582393f, 0.1345807085f, 0.1284981108f, 0.1224106752f,
        0.1163186309f, 0.1102222073f, 0.1041216339f, 0.0980171403f,
        0.0919089565f, 0.0857973123f, 0.079682438f, 0.0735645636f,
        0.0674439196f, 0.0613207363f, 0.0551952443f, 0.0490676743f,
        0.0429382569f, 0.0368072229f, 0.0306748032f, 0.024541229f,
        0.0184067299f, 0.0122715383f, 0.0061358846f, 6.123234e-17f,
        -0.0061358846f, -0.0122715383f, -0.0184067299f, -0.024541229f,
        -0.0306748032f, -0.0368072229f, -0.0429382569f, -0.0490676743f,
        -0.0551952443f, -0.0613207363f, -0.0674439196f, -0.0735645636f,
        -0.079682438f, -0.0857973123f, -0.0919089565f, -0.0980171403f,
        -0.1041216339f, -0.1102222073f, -0.1163186309f, -0.1224106752f,
        -0.1284981108f, -0.1345807085f, -0.1406582393f, -0.1467304745f,
        -0.1527971853f, -0.1588581433f, -0.1649131205f, -0.1709618888f,
        -0.1770042204f, -0.18303988796f, -0.1890686642f, -0.195090322f,
        -0.2011046348f, -0.2071113762f, -0.2131103199f, -0.2191012402f,
        -0.2250839114f, -0.2310581083f, -0.237023606f, -0.2429801799f,
        -0.2489276058f, -0.2548656596f, -0.2607941179f, -0.2667127575f,
        -0.2726213554f, -0.2785196894f, -0.2844075372f, -0.2902846772f,
        -0.2961508882f, -0.3020059493f, -0.30784964004f, -0.3136817404f,
        -0.3195020308f, -0.3253102922f, -0.3311063058f, -0.3368898534f,
        -0.3426607173f, -0.3484186803f, -0.3541635254f, -0.3598950365f,
        -0.3656129978f, -0.371317194f, -0.3770074102f, -0.3826834324f,
        -0.3883450467f, -0.3939920401f, -0.3996241998f, -0.405241314f,
        -0.4108431711f, -0.4164295601f, -0.4220002708f, -0.4275550934f,
        -0.4330938188f, -0.4386162385f, -0.4441221446f, -0.4496113297f,
        -0.4550835871f, -0.460538711f, -0.4659764958f, -0.4713967368f,
        -0.4767992301f, -0.4821837721f, -0.4875501601f, -0.4928981922f,
        -0.498227667f, -0.5035383837f, -0.5088301425f, -0.5141027442f,
        -0.5193559902f, -0.5245896827f, -0.5298036247f, -0.5349976199f,
        -0.5401714727f, -0.5453249884f, -0.550457973f, -0.555570233f,
        -0.5606615762f, -0.5657318108f, -0.5707807465f, -0.5758081868f,
        -0.5808139581f, -0.5857978575f, -0.5907597018f, -0.5956993045f,
        -0.6006164794f, -0.6055110408f, -0.6103828063f, -0.6152315906f,
        -0.6200572124f, -0.6248594881f, -0.6296382413f, -0.6343932842f,
        -0.6391244449f, -0.6438315429f, -0.6485144016f, -0.653172843f,
        -0.6578066933f, -0.6624157785f, -0.6669999225f, -0.6715590303f,
        -0.6760927232f, -0.6806010038f, -0.6850836677f, -0.689540545f,
        -0.6939714609f, -0.6983762494f, -0.7027547445f, -0.7071067812f,
        -0.7114322183f, -0.7157308253f, -0.7200025072f, -0.724247083f,
        -0.7284643897f, -0.7326542717f, -0.7368165685f, -0.7409511254f,
        -0.7450577854f, -0.7491363945f, -0.753186799f, -0.7572088479f,
        -0.7612023855f, -0.7651672656f, -0.7691033204f, -0.7730104534f,
        -0.7768884666f, -0.780737226f, -0.784556594f, -0.7883464258f,
        -0.7921065773f, -0.795836905f, -0.7995372644f, -0.8032075315f,
        -0.8068475735f, -0.8104571983f, -0.8140363249f, -0.8175848103f,
        -0.8211025144f, -0.824589303f, -0.8280450454f, -0.8314696123f,
        -0.8348628748f, -0.8382247046f, -0.8415549774f, -0.8448535652f,
        -0.848120355f, -0.8513552008f, -0.854557993f, -0.8577286123f,
        -0.8608669392f, -0.8639728561f, -0.8670462455f, -0.8700869914f,
        -0.8730949784f, -0.876070094f, -0.8790122264f, -0.8819212643f,
        -0.8847970993f, -0.8876396204f, -0.8904487232f, -0.8932243012f,
        -0.8959662498f, -0.8986744657f, -0.9013488471f, -0.9039892931f,
        -0.906595708f, -0.9091679831f, -0.911706032f, -0.9142097557f,
        -0.9166790599f, -0.9191138517f, -0.9215140393f, -0.9238795325f,
        -0.9262102426f, -0.9285060805f, -0.9307669611f, -0.9329927988f,
        -0.9351835293f, -0.9373390119f, -0.9394592237f, -0.9415440652f,
        -0.9435934582f, -0.945607335f, -0.947585591f, -0.949528179f,
        -0.951435021f, -0.9533060404f, -0.9551411759f, -0.9569403357f,
        -0.958703488f, -0.9604305237f, -0.9621214043f, -0.9637760658f,
        -0.9653944417f, -0.966976472f, -0.9685220943f, -0.9700312532f,
        -0.971503891f, -0.9729399522f, -0.9743393846f, -0.9757021306f,
        -0.9770281427f, -0.9783173715f, -0.9795697657f, -0.9807852804f,
        -0.9819639416f, -0.9831055206f, -0.984210104f, -0.9852776444f,
        -0.9863080966f, -0.9873014182f, -0.9882575698f, -0.9891765124f,
        -0.9900582103f, -0.9909026381f, -0.9917097544f, -0.9924795346f,
        -0.9932119493f, -0.9939069701f, -0.9945645707f, -0.9951847271f,
        -0.9957674145f, -0.9963126122f, -0.9968202993f, -0.9972904567f,
        -0.9977230666f, -0.9981181129f, -0.9984755806f, -0.9987954562f,
        -0.9990777185f, -0.999322382f, -0.9995294175f, -0.9996988187f,
        -0.9998305818f, -0.9999247018f, -0.9999811753f, -1.0f
    };
};

class LinkwitzRileyFilter
{
public:
    enum class Mode
    {
        LOW,
        HIGH,
        ALL
    };

    LinkwitzRileyFilter()
    :
    sample_rate_(0.f),
    frequency_(0.5f),
    mode_ (Mode::LOW)
    {
    }

    void init (float sample_rate)
    {
        sample_rate_ = sample_rate;
        nyquist_ = 0.5f * sample_rate_;
        sample_rate_inv_ = 1.0f / sample_rate_;
        update_coefficients();
    }

    void set_frequency (float frequency)
    {
        if (frequency >= 1.f)
        {
            frequency_ = 0.999f;
        }
        else
        {
            frequency_ = frequency;
        }
        update_coefficients();
    }

    void set_mode (Mode mode)
    {
        mode_ = mode;
    }

    float process (float input_sample)
    {
        float y1 = input_sample * b0_ + z1_;
        z1_ = input_sample * b1_ + z2_ - a1_ * y1;
        z2_ = input_sample * b2_ - a2_ * y1;
        
        float y2 = y1 * b0_ + z3_;
        z3_ = y1 * b1_ + z4_ - a1_ * y2;
        z4_ = y1 * b2_ - a2_ * y2;

        switch (mode_)
        {
            case Mode::LOW:
                return y2;
            case Mode::HIGH:
                return input_sample - y2;
            case Mode::ALL:
                return input_sample - 2.0f * y2;
            default:
                return y2;
        }
    }

private:
    void update_coefficients()
    {
        float f = frequency_ * nyquist_;
        int index = static_cast<int>(f * sample_rate_inv_ * TABLE_SIZE);
        // Ensure index is within bounds
        index = index & (TABLE_SIZE - 1); // Faster than modulo for power of 2 table size
        float sn = tables_.sine_table[index];
        float cs = tables_.cosine_table[index];
        float alpha = sn / sqrtf(2.0f);  // Q = sqrt(2) / 2 for Butterworth
        b0_ = (1.0f - cs) * 0.5f;
        b1_ = 1.0f - cs;
        b2_ = (1.0f - cs) * 0.5f;
        a0_ = 1.0f + alpha;
        a1_ = -2.0f * cs;
        a2_ = 1.0f - alpha;
        // Precompute inverse of a0_ to avoid division in the main loop
        float a0_inv = 1.0f / a0_;
        b0_ *= a0_inv;
        b1_ *= a0_inv;
        b2_ *= a0_inv;
        a1_ *= a0_inv;
        a2_ *= a0_inv;
        z1_ = z2_ = z3_ = z4_ = 0.0f;
    }

    float sample_rate_;
    float frequency_;
    float nyquist_;
    float sample_rate_inv_;
    Mode mode_;
    Tables tables_;
    
    float b0_, b1_, b2_, a0_, a1_, a2_;
    float z1_, z2_, z3_, z4_;
};
